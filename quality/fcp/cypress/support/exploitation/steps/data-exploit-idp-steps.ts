import { Given } from '@badeball/cypress-cucumber-preprocessor';

import {
  getIdentityProviderConfig,
  getIdentityProviderFromConfig,
} from '../helpers/idp-config-provider';

Given(
  "j'utilise la configuration pour le fournisseur d'identité {string}",
  function (idpConfigName: string) {
    expect(this.idpConfigs).to.exist;
    this.idpConfig = getIdentityProviderConfig(this.idpConfigs, idpConfigName);
  },
);

Given(
  /^j'utilise le dernier fournisseur d'identité (créé|modifié|supprimé)$/,
  function () {
    expect(this.identityProviders).to.exist;
    expect(this.idpConfigs).to.exist;
    expect(this.idpConfig).to.exist;
    // Create IDP from the last used IDP configuration
    const platform = Cypress.env('PLATFORM');
    const identityProvider = getIdentityProviderFromConfig(
      this.idpConfig,
      platform,
    );
    // Add the IDP to the IDP Array
    this.identityProviders.push(identityProvider);
    // Define a current IDP
    this.identityProvider = identityProvider;
  },
);
