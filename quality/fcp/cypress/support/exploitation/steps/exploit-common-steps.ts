import { Then, When } from '@badeball/cypress-cucumber-preprocessor';

import ExploitFormPage from '../pages/exploit-form-page';
import ExploitNavigation from '../pages/exploit-navigation';

const exploitNavigation = new ExploitNavigation();
const exploitForm = new ExploitFormPage();

/**
 * @todo Move the Cypress selector/commands to dedicated pages in future tickets
 * @author Nicolas
 * @date 20/05/2021
 */

Then(
  'je suis redirigé vers la page gestion des fournisseurs de service',
  function () {
    cy.url().should('include', '/service-provider');
  },
);

When(
  'je navigue vers la page gestion des fournisseurs de service',
  function () {
    exploitNavigation.getServiceProviderLink().click();
  },
);

Then('la liste des fournisseurs de service est affichée', function () {
  cy.get('.h2').contains('Gestion des fournisseurs de service');
});

When(
  "je navigue vers la page gestion des fournisseurs d'identité",
  function () {
    exploitNavigation.getIdentityProviderLink().click();
  },
);

Then("la liste des fournisseurs d'identité est affichée", function () {
  cy.get('.h2').contains("Gestion des fournisseurs d'identité");
});

When(
  'je navigue vers la page gestion des fournisseurs de données',
  function () {
    exploitNavigation.getDataProviderLink().click();
  },
);

Then('la liste des fournisseurs de données est affichée', function () {
  cy.get('.h2').contains('Gestion des scopes (labels) et claims');
});

When('je navigue vers la page redressement RNIPP', function () {
  exploitNavigation.getRnippLink().click();
});

When("je navigue vers la page de message d'information", function () {
  exploitNavigation.getNotificationInformationLink().click();
});

Then("je suis redirigé vers la page de message d'information", function () {
  cy.url().should('include', '/notification/information');
});

When("j'entre un totp valide", function () {
  exploitForm.fillValidTotp(this.operatorUser);
});

When("j'entre un totp invalide", function () {
  exploitForm.fillInvalidTotp();
});

Then("le message d'erreur de totp est {string}", function (message: string) {
  exploitForm.checkTotpErrorMessage(message);
});
