import { Given } from '@badeball/cypress-cucumber-preprocessor';

import {
  getServiceProviderConfig,
  getServiceProviderFromConfig,
} from '../helpers';

Given(
  "j'utilise la configuration pour le fournisseur de service {string}",
  function (spConfigName: string) {
    this.spConfig = getServiceProviderConfig(this.spConfigs, spConfigName);
  },
);

Given(
  /^j'utilise le dernier fournisseur de service (créé|modifié|supprimé)$/,
  function () {
    expect(this.serviceProviders).to.exist;
    expect(this.spConfig).to.exist;
    // Create SP from the last used SP configuration
    const platform = Cypress.env('PLATFORM');
    const serviceProvider = getServiceProviderFromConfig(
      this.spConfig,
      platform,
    );
    // Add the SP to the SP Array
    this.serviceProviders.push(serviceProvider);
    // Define a current SP
    this.serviceProvider = serviceProvider;
  },
);
