#language: fr
@exploitation @importFS @fcpLow @ci
Fonctionnalité: Rapport d'import de FS - FCP LOW
  # En tant qu'exploitant,
  # je veux pouvoir récupérer la rapport d'import de FS
  # afin de connaitre les FS créés (leurs client_id/client_secret) et les FS en erreur

  Scénario: Import de FS - Rapport cas passant
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs de service
    Et que je clique sur le bouton d'import de FS
    Et que je suis redirigé vers la page d'import de fournisseurs de service
    Quand je sélectionne le fichier d'import de FS "import-sp-success.csv"
    Et je valide le formulaire d'import de FS
    Alors le message de confirmation d'import de FS est affiché
    Et je télécharge le rapport d'import de FS "rapport.csv"
    Et le nombre de ligne est 2 dans le fichier csv "rapport.csv"
    Et je vérifie le contenu du fichier csv "rapport.csv"
      | name                   | comments                 | status  |
      | bdd-sp-success-public  | Service provider created | success |
      | bdd-sp-success-private | Service provider created | success |
    Et "client_id" contient 64 caractères pour la ligne 1 du fichier csv "rapport.csv"
    Et "client_secret" contient 64 caractères pour la ligne 1 du fichier csv "rapport.csv"
    Et "client_id" contient 64 caractères pour la ligne 2 du fichier csv "rapport.csv"
    Et "client_secret" contient 64 caractères pour la ligne 2 du fichier csv "rapport.csv"

  Scénario: Import de FS - Format du rapport
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs de service
    Et que je clique sur le bouton d'import de FS
    Et que je suis redirigé vers la page d'import de fournisseurs de service
    Quand je sélectionne le fichier d'import de FS "import-sp-success.csv"
    Et je valide le formulaire d'import de FS
    Alors le message de confirmation d'import de FS est affiché
    Et je télécharge le rapport d'import de FS "rapport.csv"
    Et le nombre de ligne est 2 dans le fichier csv "rapport.csv"
    Et le fichier csv "rapport.csv" contient les colonnes du fichier csv importé "import-sp-success.csv"
    Et le fichier csv "rapport.csv" contient le contenu du fichier csv importé "import-sp-success.csv"
    Et le fichier csv "rapport.csv" contient les colonnes "status,comments,client_id,client_secret"
    Et le fichier csv "rapport.csv" contient 16 colonnes

  Scénario: Import de FS - Rapport erreur de format
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs de service
    Et que je clique sur le bouton d'import de FS
    Et que je suis redirigé vers la page d'import de fournisseurs de service
    Quand je sélectionne le fichier d'import de FS "import-sp-format.csv"
    Et je valide le formulaire d'import de FS
    Et le message de confirmation d'import de FS est affiché
    Et je télécharge le rapport d'import de FS "rapport.csv"
    Et le nombre de ligne est 25 dans le fichier csv "rapport.csv"
    Et je vérifie le contenu du fichier csv "rapport.csv"
      | name                                                                                                                                                                                                                                                                         | comments                                                                                      | status  |
      |                                                                                                                                                                                                                                                                              | name                                                                                          | error   |
      | bdd-sp-format-name-too-long-123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890 | name                                                                                          | error   |
      | bdd-sp-format-redirect-uris-missing                                                                                                                                                                                                                                          | redirect_uris                                                                                 | error   |
      | bdd-sp-format-redirect-uris-wrong                                                                                                                                                                                                                                            | redirect_uris                                                                                 | error   |
      | bdd-sp-format-post-logout-redirect-uris-missing                                                                                                                                                                                                                              | post_logout_redirect_uris                                                                     | error   |
      | bdd-sp-format-post-logout-redirect-uris-wrong                                                                                                                                                                                                                                | post_logout_redirect_uris                                                                     | error   |
      | bdd-sp-format-adresses-ip-missing                                                                                                                                                                                                                                            | Service provider created                                                                      | success |
      | bdd-sp-format-adresses-ip-wrong                                                                                                                                                                                                                                              | Service provider created                                                                      | success |
      | bdd-sp-format-datapass-id-missing                                                                                                                                                                                                                                            | datapassId                                                                                    | error   |
      | bdd-sp-format-datapass-id-wrong                                                                                                                                                                                                                                              | datapassId                                                                                    | error   |
      | bdd-sp-format-scopes-missing                                                                                                                                                                                                                                                 | scopes                                                                                        | error   |
      | bdd-sp-format-scopes-wrong                                                                                                                                                                                                                                                   | scopes                                                                                        | error   |
      | bdd-sp-format-type-missing                                                                                                                                                                                                                                                   | type                                                                                          | error   |
      | bdd-sp-format-type-wrong                                                                                                                                                                                                                                                     | type                                                                                          | error   |
      | bdd-sp-format-response-alg-missing                                                                                                                                                                                                                                           | signedResponseAlg                                                                             | error   |
      | bdd-sp-format-response-alg-wrong                                                                                                                                                                                                                                             | signedResponseAlg                                                                             | error   |
      | bdd-sp-format-email-missing                                                                                                                                                                                                                                                  | email                                                                                         | error   |
      | bdd-sp-format-email-wrong                                                                                                                                                                                                                                                    | email                                                                                         | error   |
      | bdd-sp-format-phone-missing                                                                                                                                                                                                                                                  | phone                                                                                         | error   |
      | bdd-sp-format-phone-wrong                                                                                                                                                                                                                                                    | phone                                                                                         | error   |
      | bdd-sp-format-client-id-v1-missing                                                                                                                                                                                                                                           | Service provider created                                                                      | success |
      | bdd-sp-format-client-id-v1-wrong                                                                                                                                                                                                                                             | entityId                                                                                      | error   |
      | bdd-sp-format-site-missing                                                                                                                                                                                                                                                   | site                                                                                          | error   |
      | bdd-sp-format-site-wrong                                                                                                                                                                                                                                                     | site                                                                                          | error   |
      | bdd-sp-format-bad-format                                                                                                                                                                                                                                                     | scopes, type, redirect_uris, post_logout_redirect_uris, signedResponseAlg, email, phone, site | error   |

  Scénario: Import de FS - Rapport erreur de doublons
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs de service
    Et que je clique sur le bouton d'import de FS
    Et que je suis redirigé vers la page d'import de fournisseurs de service
    Quand je sélectionne le fichier d'import de FS "import-sp-duplicate.csv"
    Et je valide le formulaire d'import de FS
    Alors le message de confirmation d'import de FS est affiché
    Et je télécharge le rapport d'import de FS "rapport.csv"
    Et le nombre de ligne est 7 dans le fichier csv "rapport.csv"
    Et je vérifie le contenu du fichier csv "rapport.csv"
      | name                                          | comments                                    | status  |
      | bdd-sp-created-existing-datapass-v1           | Service provider created                    | success |
      | bdd-sp-created-existing-entity-id-v1          | Service provider created                    | success |
      | bdd-sp-rejected-existing-datapass-v2          | Already present in the database .*          | error   |
      | bdd-sp-rejected-existing-entity-id-v2         | Already present in the database .*          | error   |
      | bdd-sp-duplicate-same-file-datapass-entity-id | duplicate datapassId and duplicate entityId | error   |
      | bdd-sp-duplicate-same-file-datapass           | duplicate datapassId                        | error   |
      | bdd-sp-duplicate-same-file-entity-id          | duplicate entityId                          | error   |

  Scénario: Suppression des FS commençant par "bdd-sp-"
    Etant donné que je navigue sur la page login d'exploitation
    Et je me connecte à exploitation en tant que "exploitant"
    Et je navigue vers la page gestion des fournisseurs de service
    Quand je supprime les fournisseurs de service commençant par "bdd-sp-"
