import { ChainableElement } from '../../common/types';
import { OperatorUser } from '../helpers';

export default class ExploitLoginPage {
  exploitRootUrl: string;
  exploitLoginPath: string;

  constructor(exploitRootUrl: string) {
    this.exploitRootUrl = exploitRootUrl;
    this.exploitLoginPath = '/login';
  }

  getUsernameInput(): ChainableElement {
    return cy.get('input[name="username"]');
  }

  getPasswordInput(): ChainableElement {
    return cy.get('input[name="password"]');
  }

  getTotpInput(): ChainableElement {
    return cy.get('input[name="_totp"]');
  }

  getLoginButton(): ChainableElement {
    return cy.get('button[type="submit"]');
  }

  checkIsVisible(): void {
    cy.url().should(
      'includes',
      `${this.exploitRootUrl}${this.exploitLoginPath}`,
    );
  }

  login(user: OperatorUser): void {
    this.getUsernameInput().clear().type(user.username);
    this.getPasswordInput().clear().type(user.password, { log: false });
    this.getTotpInput()
      .then(() => user.wrapTotp())
      .then((totp: string) => this.getTotpInput().clearThenType(totp));
    this.getLoginButton().click();
  }
}
