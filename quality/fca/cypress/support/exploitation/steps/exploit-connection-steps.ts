import { Given, Then, When } from '@badeball/cypress-cucumber-preprocessor';

import { navigateTo } from '../../common/helpers';
import { Environment } from '../../common/types';
import { getOperatorUserByType } from '../helpers';
import ExploitLoginPage from '../pages/exploit-login-page';
import ExploitNavigation from '../pages/exploit-navigation';

let exploitLoginPage: ExploitLoginPage;
const exploitNavigation = new ExploitNavigation();

Given("je navigue sur la page login d'exploitation", function () {
  const env: Environment = this.env;
  exploitLoginPage = new ExploitLoginPage(env.exploitRootUrl);
  navigateTo({ appId: env.exploitAppId, baseUrl: env.allAppsUrl });
});

When(
  'je me connecte à exploitation en tant que {string}',
  function (userType: string) {
    this.operatorUser = getOperatorUserByType(userType);
    exploitLoginPage.login(this.operatorUser);
  },
);

When("je me déconnecte d'exploitation", function () {
  exploitNavigation.logout();
});

Then("je suis redirigé vers la page login d'exploitation", function () {
  exploitLoginPage.checkIsVisible();
});
