import { Then, When } from '@badeball/cypress-cucumber-preprocessor';

import { ServiceProvider, ServiceProviderConfig } from '../../common/types';
import { OperatorUser } from '../helpers';
import ExploitSpListPage from '../pages/exploit-sp-list-page';

const exploitSpListPage = new ExploitSpListPage();

When('je clique sur le bouton de création de FS', function () {
  exploitSpListPage.getCreateSpButton().click();
});

When(
  'je clique sur le bouton de modification du FS {string}',
  function (spName: string) {
    exploitSpListPage.navigateToUpdateSpPage(spName);
    // Update SP config
    this.spConfig = this.spConfig ?? {};
    this.spConfig['name'] = spName;
  },
);

When('je clique sur le bouton de modification du FS', function () {
  const { name: spName }: ServiceProvider = this.serviceProvider;
  exploitSpListPage.navigateToUpdateSpPage(spName);
  // Update SP config
  this.spConfig = this.spConfig ?? {};
  this.spConfig['name'] = spName;
});

When(
  /^je supprime le fournisseur de service "([^"]*)"$/,
  function (spName: string) {
    const user: OperatorUser = this.operatorUser;
    exploitSpListPage.deleteSp(spName, user);
  },
);

When(
  /^je supprime les fournisseurs de service commençant par "([^"]*)"$/,
  function (spName: string) {
    const user: OperatorUser = this.operatorUser;
    exploitSpListPage.deleteAllSpStartingWith(spName, user);
  },
);

Then('le message de confirmation de création de FS est affiché', function () {
  const { name: spName }: ServiceProviderConfig = this.spConfig;
  exploitSpListPage.checkConfirmCreateMessage(spName);
});

When(
  'le message de confirmation de suppression du FS {string} est affiché',
  (spName: string) => {
    exploitSpListPage.checkConfirmDeleteMessage(spName);
  },
);

Then(
  'le message de confirmation de modification de FS est affiché',
  function () {
    const { name: spName }: ServiceProviderConfig = this.spConfig;
    exploitSpListPage.checkConfirmUpdateMessage(spName);
  },
);
